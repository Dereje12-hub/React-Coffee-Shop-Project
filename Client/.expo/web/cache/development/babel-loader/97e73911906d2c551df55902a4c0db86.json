{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.remoteDevtoolsCorsMiddleware = void 0;\n\nvar url_1 = require(\"url\");\n\nfunction remoteDevtoolsCorsMiddleware(req, res, next) {\n  var _a;\n\n  if (req.url) {\n    var url = url_1.parse(req.url);\n    var origin = req.headers.origin;\n    var isValidOrigin = origin && ['devtools://devtools', 'https://chrome-devtools-frontend.appspot.com'].includes(origin);\n\n    if (((_a = url.pathname) === null || _a === void 0 ? void 0 : _a.endsWith('.map')) && origin && isValidOrigin) {\n      res.setHeader('Access-Control-Allow-Origin', origin);\n      var setHeader = res.setHeader.bind(res);\n\n      res.setHeader = function (key) {\n        if (key === 'Access-Control-Allow-Origin') {\n          return;\n        }\n\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        setHeader.apply(void 0, [key].concat(args));\n      };\n    }\n  }\n\n  next();\n}\n\nexports.remoteDevtoolsCorsMiddleware = remoteDevtoolsCorsMiddleware;","map":{"version":3,"sources":["../../src/middleware/remoteDevtoolsCorsMiddleware.ts"],"names":[],"mappings":";;;;;;;AACA,IAAA,KAAA,GAAA,OAAA,CAAA,KAAA,CAAA;;AAKA,SAAgB,4BAAhB,CACE,GADF,EAEE,GAFF,EAGE,IAHF,EAG6B;;;AAE3B,MAAI,GAAG,CAAC,GAAR,EAAa;AACX,QAAM,GAAG,GAAG,KAAA,CAAA,KAAA,CAAS,GAAG,CAAC,GAAb,CAAZ;AACA,QAAM,MAAM,GAAG,GAAG,CAAC,OAAJ,CAAY,MAA3B;AACA,QAAM,aAAa,GACjB,MAAM,IACN,CAAC,qBAAD,EAAwB,8CAAxB,EAAwE,QAAxE,CAAiF,MAAjF,CAFF;;AAGA,QAAI,CAAA,CAAA,EAAA,GAAA,GAAG,CAAC,QAAJ,MAAY,IAAZ,IAAY,EAAA,KAAA,KAAA,CAAZ,GAAY,KAAA,CAAZ,GAAY,EAAA,CAAE,QAAF,CAAW,MAAX,CAAZ,KAAkC,MAAlC,IAA4C,aAAhD,EAA+D;AAC7D,MAAA,GAAG,CAAC,SAAJ,CAAc,6BAAd,EAA6C,MAA7C;AAGA,UAAM,SAAS,GAAG,GAAG,CAAC,SAAJ,CAAc,IAAd,CAAmB,GAAnB,CAAlB;;AACA,MAAA,GAAG,CAAC,SAAJ,GAAgB,UAAC,GAAD,EAAiB;AAC/B,YAAI,GAAG,KAAK,6BAAZ,EAA2C;AACzC;AACD;;AAH8B,0CAAR,IAAQ;AAAR,UAAA,IAAQ;AAAA;;AAI/B,QAAA,SAAS,MAAT,UAAU,GAAV,SAAkB,IAAlB;AACD,OALD;AAMD;AACF;;AACD,EAAA,IAAI;AACL;;AAzBD,OAAA,CAAA,4BAAA,GAAA,4BAAA","sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\nimport { parse as parseUrl } from 'url';\n\n// Middleware that accepts multiple Access-Control-Allow-Origin for processing *.map.\n// This is a hook middleware before metro processing *.map,\n// which originally allow only devtools://devtools\nexport function remoteDevtoolsCorsMiddleware(\n  req: IncomingMessage,\n  res: ServerResponse,\n  next: (err?: Error) => void\n) {\n  if (req.url) {\n    const url = parseUrl(req.url);\n    const origin = req.headers.origin;\n    const isValidOrigin =\n      origin &&\n      ['devtools://devtools', 'https://chrome-devtools-frontend.appspot.com'].includes(origin);\n    if (url.pathname?.endsWith('.map') && origin && isValidOrigin) {\n      res.setHeader('Access-Control-Allow-Origin', origin);\n\n      // Prevent metro overwrite Access-Control-Allow-Origin header\n      const setHeader = res.setHeader.bind(res);\n      res.setHeader = (key, ...args) => {\n        if (key === 'Access-Control-Allow-Origin') {\n          return;\n        }\n        setHeader(key, ...args);\n      };\n    }\n  }\n  next();\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}