{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction maybeFetchPlugin(compiler, name) {\n  var _a, _b;\n\n  return (_b = (_a = compiler.options) === null || _a === void 0 ? void 0 : _a.plugins) === null || _b === void 0 ? void 0 : _b.map(function (_ref) {\n    var constructor = _ref.constructor;\n    return constructor;\n  }).find(function (constructor) {\n    return constructor && constructor.name === name;\n  });\n}\n\nvar ModifyHtmlWebpackPlugin = function () {\n  function ModifyHtmlWebpackPlugin() {\n    var modifyOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, ModifyHtmlWebpackPlugin);\n\n    this.modifyOptions = modifyOptions;\n  }\n\n  _createClass(ModifyHtmlWebpackPlugin, [{\n    key: \"modifyAsync\",\n    value: function modifyAsync(compiler, compilation, data) {\n      return _regeneratorRuntime.async(function modifyAsync$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              return _context.abrupt(\"return\", data);\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }, {\n    key: \"apply\",\n    value: function apply(compiler) {\n      var _this = this;\n\n      compiler.hooks.make.tapPromise(this.constructor.name, function _callee2(compilation) {\n        var HtmlWebpackPlugin;\n        return _regeneratorRuntime.async(function _callee2$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                HtmlWebpackPlugin = maybeFetchPlugin(compiler, 'HtmlWebpackPlugin');\n\n                if (!HtmlWebpackPlugin) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                if (!(typeof HtmlWebpackPlugin.getHooks === 'undefined')) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                compilation.errors.push(new Error('ModifyHtmlWebpackPlugin - This ModifyHtmlWebpackPlugin version is not compatible with your current HtmlWebpackPlugin version.\\n'));\n                return _context3.abrupt(\"return\");\n\n              case 5:\n                HtmlWebpackPlugin.getHooks(compilation).alterAssetTags.tapAsync(_this.constructor.name, function _callee(data, htmlCallback) {\n                  var isInjectionAllowed;\n                  return _regeneratorRuntime.async(function _callee$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          isInjectionAllowed = typeof _this.modifyOptions.inject === 'function' ? _this.modifyOptions.inject(data.plugin) : data.plugin.options.pwaManifest !== false;\n\n                          if (!(isInjectionAllowed === false)) {\n                            _context2.next = 3;\n                            break;\n                          }\n\n                          return _context2.abrupt(\"return\", htmlCallback(null, data));\n\n                        case 3:\n                          _context2.prev = 3;\n                          _context2.next = 6;\n                          return _regeneratorRuntime.awrap(_this.modifyAsync(compiler, compilation, data));\n\n                        case 6:\n                          data = _context2.sent;\n                          _context2.next = 12;\n                          break;\n\n                        case 9:\n                          _context2.prev = 9;\n                          _context2.t0 = _context2[\"catch\"](3);\n                          compilation.errors.push(_context2.t0);\n\n                        case 12:\n                          htmlCallback(null, data);\n\n                        case 13:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, null, null, [[3, 9]], Promise);\n                });\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      });\n    }\n  }]);\n\n  return ModifyHtmlWebpackPlugin;\n}();\n\nexports.default = ModifyHtmlWebpackPlugin;","map":{"version":3,"sources":["../../src/plugins/ModifyHtmlWebpackPlugin.ts"],"names":[],"mappings":";;;;;;;;;;;;AAEA,SAAS,gBAAT,CAA0B,QAA1B,EAA8C,IAA9C,EAA0D;;;AACxD,SAAO,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,QAAQ,CAAC,OAAT,MAAgB,IAAhB,IAAgB,EAAA,KAAA,KAAA,CAAhB,GAAgB,KAAA,CAAhB,GAAgB,EAAA,CAAE,OAAlB,MAAyB,IAAzB,IAAyB,EAAA,KAAA,KAAA,CAAzB,GAAyB,KAAA,CAAzB,GAAyB,EAAA,CAC5B,GAD4B,CACxB;AAAA,QAAG,WAAH,QAAG,WAAH;AAAA,WAAqB,WAArB;AAAA,GADwB,EAE7B,IAF6B,CAExB,UAAA,WAAW;AAAA,WAAI,WAAW,IAAI,WAAW,CAAC,IAAZ,KAAqB,IAAxC;AAAA,GAFa,CAAhC;AAGD;;IAkBoB,uB;AACnB,qCAAuE;AAAA,QAAnD,aAAmD,uEAAF,EAAE;;AAAA;;AAAnD,SAAA,aAAA,GAAA,aAAA;AAAuD;;;;WAE3E,qBACE,QADF,EAEE,WAFF,EAGE,IAHF;AAAA;AAAA;AAAA;AAAA;AAAA,+CAKS,IALT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;WAQA,eAAM,QAAN,EAAwB;AAAA;;AACtB,MAAA,QAAQ,CAAC,KAAT,CAAe,IAAf,CAAoB,UAApB,CACE,KAAK,WAAL,CAAiB,IADnB,EAEE,kBAAO,WAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAEQ,gBAAA,iBAFR,GAE4B,gBAAgB,CAAC,QAAD,EAAW,mBAAX,CAF5C;;AAAA,qBAGM,iBAHN;AAAA;AAAA;AAAA;;AAAA,sBAIQ,OAAO,iBAAiB,CAAC,QAAzB,KAAsC,WAJ9C;AAAA;AAAA;AAAA;;AAKM,gBAAA,WAAW,CAAC,MAAZ,CAAmB,IAAnB,CACE,IAAI,KAAJ,CACE,iIADF,CADF;AALN;;AAAA;AAaI,gBAAA,iBAAiB,CAAC,QAAlB,CAA2B,WAA3B,EAAwC,cAAxC,CAAuD,QAAvD,CACE,KAAI,CAAC,WAAL,CAAiB,IADnB,EAEE,iBACE,IADF,EAEE,YAFF;AAAA;AAAA;AAAA;AAAA;AAAA;AAMQ,0BAAA,kBANR,GAOI,OAAO,KAAI,CAAC,aAAL,CAAmB,MAA1B,KAAqC,UAArC,GACI,KAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,IAAI,CAAC,MAA/B,CADJ,GAEI,IAAI,CAAC,MAAL,CAAY,OAAZ,CAAoB,WAApB,KAAoC,KAT5C;;AAAA,gCAWM,kBAAkB,KAAK,KAX7B;AAAA;AAAA;AAAA;;AAAA,4DAYW,YAAY,CAAC,IAAD,EAAO,IAAP,CAZvB;;AAAA;AAAA;AAAA;AAAA,2DAgBiB,KAAI,CAAC,WAAL,CAAiB,QAAjB,EAA2B,WAA3B,EAAwC,IAAxC,CAhBjB;;AAAA;AAgBI,0BAAA,IAhBJ;AAAA;AAAA;;AAAA;AAAA;AAAA;AAkBI,0BAAA,WAAW,CAAC,MAAZ,CAAmB,IAAnB;;AAlBJ;AAqBE,0BAAA,YAAY,CAAC,IAAD,EAAO,IAAP,CAAZ;;AArBF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAFF;;AAbJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAFF;AA4CD;;;;;;AAxDH,OAAA,CAAA,OAAA,GAAA,uBAAA","sourcesContent":["import { compilation as compilationNS, Compiler, Plugin } from 'webpack';\n\nfunction maybeFetchPlugin(compiler: Compiler, name: string): Plugin | undefined {\n  return compiler.options?.plugins\n    ?.map(({ constructor }) => constructor)\n    .find(constructor => constructor && constructor.name === name);\n}\n\nexport type HTMLPluginData = {\n  assetTags: any;\n  outputName: string;\n  plugin: any;\n};\n\nexport type HTMLLinkNode = {\n  rel?: string;\n  name?: string;\n  content?: string;\n  media?: string;\n  href?: string;\n  sizes?: string;\n  node: any;\n};\n\nexport default class ModifyHtmlWebpackPlugin {\n  constructor(private modifyOptions: { inject?: boolean | Function } = {}) {}\n\n  async modifyAsync(\n    compiler: Compiler,\n    compilation: compilationNS.Compilation,\n    data: HTMLPluginData\n  ): Promise<HTMLPluginData> {\n    return data;\n  }\n\n  apply(compiler: Compiler) {\n    compiler.hooks.make.tapPromise(\n      this.constructor.name,\n      async (compilation: compilationNS.Compilation) => {\n        // Hook into the html-webpack-plugin processing and add the html\n        const HtmlWebpackPlugin = maybeFetchPlugin(compiler, 'HtmlWebpackPlugin') as any;\n        if (HtmlWebpackPlugin) {\n          if (typeof HtmlWebpackPlugin.getHooks === 'undefined') {\n            compilation.errors.push(\n              new Error(\n                'ModifyHtmlWebpackPlugin - This ModifyHtmlWebpackPlugin version is not compatible with your current HtmlWebpackPlugin version.\\n'\n              )\n            );\n            return;\n          }\n\n          HtmlWebpackPlugin.getHooks(compilation).alterAssetTags.tapAsync(\n            this.constructor.name,\n            async (\n              data: HTMLPluginData,\n              htmlCallback: (error: Error | null, data: HTMLPluginData) => void\n            ) => {\n              // Skip if a custom injectFunction returns false or if\n              // the htmlWebpackPlugin optuons includes a `favicons: false` flag\n              const isInjectionAllowed =\n                typeof this.modifyOptions.inject === 'function'\n                  ? this.modifyOptions.inject(data.plugin)\n                  : data.plugin.options.pwaManifest !== false;\n\n              if (isInjectionAllowed === false) {\n                return htmlCallback(null, data);\n              }\n\n              try {\n                data = await this.modifyAsync(compiler, compilation, data);\n              } catch (error) {\n                compilation.errors.push(error);\n              }\n\n              htmlCallback(null, data);\n            }\n          );\n        }\n      }\n    );\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}