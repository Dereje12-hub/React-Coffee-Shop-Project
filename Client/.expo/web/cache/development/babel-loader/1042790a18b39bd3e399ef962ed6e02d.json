{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getModuleBuildError = void 0;\n\nvar path = __importStar(require(\"path\"));\n\nvar parseBabelError_1 = require(\"./parseBabelError\");\n\nvar parseNotFoundError_1 = require(\"./parseNotFoundError\");\n\nfunction getFileData(compilation, m) {\n  var _a, _b, _c, _d;\n\n  var resolved;\n  var ctx = (_c = (_b = (_a = compilation.compiler) === null || _a === void 0 ? void 0 : _a.context) !== null && _b !== void 0 ? _b : compilation.context) !== null && _c !== void 0 ? _c : null;\n\n  if (ctx !== null && typeof m.resource === 'string') {\n    var res = path.relative(ctx, m.resource).replace(/\\\\/g, path.posix.sep);\n    resolved = res.startsWith('.') ? res : \".\" + path.posix.sep + res;\n  } else {\n    var requestShortener = compilation.requestShortener;\n\n    if (typeof (m === null || m === void 0 ? void 0 : m.readableIdentifier) === 'function') {\n      resolved = m.readableIdentifier(requestShortener);\n    } else {\n      resolved = (_d = m.request) !== null && _d !== void 0 ? _d : m.userRequest;\n    }\n  }\n\n  return resolved || '<unknown>';\n}\n\nfunction getModuleBuildError(compilation, input) {\n  var sourceFilename, notFoundError, babel;\n  return _regeneratorRuntime.async(function getModuleBuildError$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (typeof input === 'object' && ['ModuleBuildError', 'ModuleNotFoundError', 'ModuleDependencyWarning'].includes(input.name) && Boolean(input.module) && input.error instanceof Error) {\n            _context.next = 2;\n            break;\n          }\n\n          return _context.abrupt(\"return\", false);\n\n        case 2:\n          sourceFilename = getFileData(compilation, input.module);\n\n          if (!(input.name === 'ModuleDependencyWarning')) {\n            _context.next = 7;\n            break;\n          }\n\n          _context.next = 6;\n          return _regeneratorRuntime.awrap(parseNotFoundError_1.getModuleDependencyWarning(compilation, input, sourceFilename));\n\n        case 6:\n          return _context.abrupt(\"return\", _context.sent);\n\n        case 7:\n          _context.next = 9;\n          return _regeneratorRuntime.awrap(parseNotFoundError_1.getNotFoundError(compilation, input, sourceFilename));\n\n        case 9:\n          notFoundError = _context.sent;\n\n          if (!(notFoundError !== false)) {\n            _context.next = 12;\n            break;\n          }\n\n          return _context.abrupt(\"return\", notFoundError);\n\n        case 12:\n          babel = parseBabelError_1.getBabelError(sourceFilename, input.error);\n\n          if (!(babel !== false)) {\n            _context.next = 15;\n            break;\n          }\n\n          return _context.abrupt(\"return\", babel);\n\n        case 15:\n          return _context.abrupt(\"return\", false);\n\n        case 16:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nexports.getModuleBuildError = getModuleBuildError;","map":{"version":3,"sources":["../../../src/plugins/ExpectedErrors/getModuleBuildError.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2021 Expo, Inc.\n * Copyright (c) 2021 Vercel, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * Based on https://github.com/vercel/next.js/blob/1552b8341e5b512a2827485a4a9689cd429c520e/packages/next/build/webpack/plugins/wellknown-errors-plugin/webpackModuleError.ts\n */\nimport * as path from 'path';\nimport webpack from 'webpack';\n\nimport { WebpackFileError } from './WebpackFileError';\nimport { getBabelError } from './parseBabelError';\nimport { getModuleDependencyWarning, getNotFoundError } from './parseNotFoundError';\n\nfunction getFileData(compilation: webpack.compilation.Compilation, m: any): string {\n  let resolved: string;\n  const ctx: string | null = compilation.compiler?.context ?? compilation.context ?? null;\n  if (ctx !== null && typeof m.resource === 'string') {\n    const res = path.relative(ctx, m.resource).replace(/\\\\/g, path.posix.sep);\n    resolved = res.startsWith('.') ? res : `.${path.posix.sep}${res}`;\n  } else {\n    const requestShortener = compilation.requestShortener;\n    if (typeof m?.readableIdentifier === 'function') {\n      resolved = m.readableIdentifier(requestShortener);\n    } else {\n      resolved = m.request ?? m.userRequest;\n    }\n  }\n\n  return resolved || '<unknown>';\n}\n\nexport async function getModuleBuildError(\n  compilation: webpack.compilation.Compilation,\n  input: any\n): Promise<WebpackFileError | false> {\n  if (\n    !(\n      typeof input === 'object' &&\n      ['ModuleBuildError', 'ModuleNotFoundError', 'ModuleDependencyWarning'].includes(input.name) &&\n      Boolean(input.module) &&\n      input.error instanceof Error\n    )\n  ) {\n    return false;\n  }\n\n  const sourceFilename = getFileData(compilation, input.module);\n\n  if (input.name === 'ModuleDependencyWarning') {\n    return await getModuleDependencyWarning(compilation, input, sourceFilename);\n  }\n\n  const notFoundError = await getNotFoundError(compilation, input, sourceFilename);\n  if (notFoundError !== false) {\n    return notFoundError;\n  }\n\n  const babel = getBabelError(sourceFilename, input.error);\n  if (babel !== false) {\n    return babel;\n  }\n\n  return false;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}