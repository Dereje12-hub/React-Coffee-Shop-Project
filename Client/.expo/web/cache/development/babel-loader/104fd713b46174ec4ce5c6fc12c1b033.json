{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\n\nvar _get = require(\"@babel/runtime/helpers/get\");\n\nvar _inherits = require(\"@babel/runtime/helpers/inherits\");\n\nvar _possibleConstructorReturn = require(\"@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"@babel/runtime/helpers/getPrototypeOf\");\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar chalk_1 = __importDefault(require(\"chalk\"));\n\nvar html_webpack_plugin_1 = __importDefault(require(\"html-webpack-plugin\"));\n\nvar env_1 = require(\"../env\");\n\nvar utils_1 = require(\"../utils\");\n\nvar DEFAULT_MINIFY = {\n  removeComments: true,\n  collapseWhitespace: true,\n  removeRedundantAttributes: true,\n  useShortDoctype: true,\n  removeEmptyAttributes: true,\n  removeStyleLinkTypeAttributes: true,\n  keepClosingSlash: true,\n  minifyJS: true,\n  minifyCSS: true,\n  minifyURLs: true\n};\n\nvar HtmlWebpackPlugin = function (_html_webpack_plugin_) {\n  _inherits(HtmlWebpackPlugin, _html_webpack_plugin_);\n\n  var _super = _createSuper(HtmlWebpackPlugin);\n\n  function HtmlWebpackPlugin(env, templateHtmlData) {\n    var _this;\n\n    _classCallCheck(this, HtmlWebpackPlugin);\n\n    var _a, _b, _c, _d, _e, _f, _g;\n\n    var locations = env.locations || env_1.getPaths(env.projectRoot, env);\n    var config = env_1.getConfig(env);\n    var isProduction = env_1.getMode(env) === 'production';\n    var minify = utils_1.overrideWithPropertyOrConfig(isProduction ? (_b = (_a = config.web) === null || _a === void 0 ? void 0 : _a.build) === null || _b === void 0 ? void 0 : _b.minifyHTML : false, DEFAULT_MINIFY);\n    var meta = {};\n\n    if (templateHtmlData && templateHtmlData.querySelectorAll) {\n      var templateMeta = templateHtmlData.querySelectorAll('meta');\n\n      if (!templateMeta.some(function (node) {\n        return node.getAttribute('name') === 'viewport';\n      })) {\n        console.warn(chalk_1.default.bgYellow.black('Warning: No viewport meta tag is defined in the <head /> of `web/index.html`. Please update your `web/index.html` to include one. The default value is:\\n\\n') + chalk_1.default.magenta('<meta name=\"viewport\" content=\"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1.00001,viewport-fit=cover\">'));\n        meta.viewport = 'width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1.00001, viewport-fit=cover';\n      }\n\n      if (((_c = config.web) === null || _c === void 0 ? void 0 : _c.themeColor) && !templateMeta.some(function (node) {\n        return node.getAttribute('name') === 'theme-color';\n      })) {\n        meta['theme-color'] = (_d = config.web) === null || _d === void 0 ? void 0 : _d.themeColor;\n      }\n\n      if (((_e = config.web) === null || _e === void 0 ? void 0 : _e.description) && !templateMeta.some(function (node) {\n        return node.getAttribute('name') === 'description';\n      })) {\n        meta['description'] = (_f = config.web) === null || _f === void 0 ? void 0 : _f.description;\n      }\n    }\n\n    _this = _super.call(this, {\n      filename: locations.production.indexHtml,\n      title: (_g = config.web) === null || _g === void 0 ? void 0 : _g.name,\n      minify: minify,\n      template: locations.template.indexHtml,\n      meta: meta\n    });\n    _this.platform = env.platform;\n    return _this;\n  }\n\n  _createClass(HtmlWebpackPlugin, [{\n    key: \"generatedScriptTags\",\n    value: function generatedScriptTags(jsAssets) {\n      var _this2 = this;\n\n      var isNative = ['ios', 'android'].includes(this.platform);\n\n      if (!isNative) {\n        return _get(_getPrototypeOf(HtmlWebpackPlugin.prototype), \"generatedScriptTags\", this).call(this, jsAssets);\n      }\n\n      return jsAssets.map(function (scriptAsset) {\n        return {\n          tagName: 'script',\n          voidTag: false,\n          attributes: {\n            defer: _this2.options.scriptLoading !== 'blocking',\n            type: 'application/expo+javascript',\n            'data-platform': _this2.platform,\n            src: scriptAsset\n          }\n        };\n      });\n    }\n  }]);\n\n  return HtmlWebpackPlugin;\n}(html_webpack_plugin_1.default);\n\nexports.default = HtmlWebpackPlugin;","map":{"version":3,"sources":["../../src/plugins/ExpoHtmlWebpackPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["import chalk from 'chalk';\nimport OriginalHtmlWebpackPlugin from 'html-webpack-plugin';\n\nimport { getConfig, getMode, getPaths } from '../env';\nimport { Environment } from '../types';\nimport { overrideWithPropertyOrConfig } from '../utils';\n\nconst DEFAULT_MINIFY = {\n  removeComments: true,\n  collapseWhitespace: true,\n  removeRedundantAttributes: true,\n  useShortDoctype: true,\n  removeEmptyAttributes: true,\n  removeStyleLinkTypeAttributes: true,\n  keepClosingSlash: true,\n  minifyJS: true,\n  minifyCSS: true,\n  minifyURLs: true,\n};\n\n/**\n * Generates an `index.html` file with the <script> injected.\n *\n * @category plugins\n */\nexport default class HtmlWebpackPlugin extends OriginalHtmlWebpackPlugin {\n  private platform: string;\n\n  constructor(env: Environment, templateHtmlData?: any) {\n    const locations = env.locations || getPaths(env.projectRoot, env);\n    const config = getConfig(env);\n    const isProduction = getMode(env) === 'production';\n\n    /**\n     * The user can disable minify with\n     * `web.minifyHTML = false || {}`\n     */\n    const minify = overrideWithPropertyOrConfig(\n      isProduction ? config.web?.build?.minifyHTML : false,\n      DEFAULT_MINIFY\n    );\n\n    const meta: Record<string, any> = {};\n\n    if (templateHtmlData && templateHtmlData.querySelectorAll) {\n      // @ts-ignore\n      const templateMeta = templateHtmlData.querySelectorAll('meta');\n\n      // Ensure there is no viewport meta tag in the default `web/index.html`.\n      // Because the viewport tag has been moved into the template, this will\n      // ensure that legacy `web/index.html`s get a viewport meta tag added to them.\n      if (!templateMeta.some((node: any) => node.getAttribute('name') === 'viewport')) {\n        console.warn(\n          chalk.bgYellow.black(\n            'Warning: No viewport meta tag is defined in the <head /> of `web/index.html`. Please update your `web/index.html` to include one. The default value is:\\n\\n'\n          ) +\n            chalk.magenta(\n              '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1.00001,viewport-fit=cover\">'\n            )\n        );\n        meta.viewport =\n          'width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1.00001, viewport-fit=cover';\n      }\n      // Meta tag to define a suggested color that browsers should use to customize the display of the page or of the surrounding user interface.\n      // The meta tag overrides any theme-color set in the web app manifest.\n      if (\n        config.web?.themeColor &&\n        !templateMeta.some((node: any) => node.getAttribute('name') === 'theme-color')\n      ) {\n        meta['theme-color'] = config.web?.themeColor;\n      }\n\n      if (\n        config.web?.description &&\n        !templateMeta.some((node: any) => node.getAttribute('name') === 'description')\n      ) {\n        meta['description'] = config.web?.description;\n      }\n    }\n\n    super({\n      // The file to write the HTML to.\n      filename: locations.production.indexHtml,\n      // The title to use for the generated HTML document.\n      title: config.web?.name,\n      // Pass a html-minifier options object to minify the output.\n      // https://github.com/kangax/html-minifier#options-quick-reference\n      minify,\n      // The `webpack` require path to the template.\n      template: locations.template.indexHtml,\n      meta,\n    });\n    this.platform = env.platform;\n  }\n\n  generatedScriptTags(jsAssets: any) {\n    const isNative = ['ios', 'android'].includes(this.platform);\n    if (!isNative) {\n      // @ts-ignore\n      return super.generatedScriptTags(jsAssets);\n    }\n    return jsAssets.map((scriptAsset: any) => ({\n      tagName: 'script',\n      voidTag: false,\n      attributes: {\n        // @ts-ignore\n        defer: this.options.scriptLoading !== 'blocking',\n        type: 'application/expo+javascript',\n        'data-platform': this.platform,\n        src: scriptAsset,\n      },\n    }));\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}