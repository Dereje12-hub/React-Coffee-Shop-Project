{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar _slicedToArray = require(\"@babel/runtime/helpers/slicedToArray\");\n\nvar _defineProperty = require(\"@babel/runtime/helpers/defineProperty\");\n\nvar _toConsumableArray = require(\"@babel/runtime/helpers/toConsumableArray\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.resolveEntryAsync = exports.isEntry = exports.isRuleSetLoader = exports.isRuleSetItem = exports.getPluginsByName = exports.getPlugins = exports.conditionMatchesFile = exports.resolveRuleSetUse = exports.rulesMatchAnyFiles = exports.getRulesByMatchingFiles = exports.getLoaders = exports.getLoadersFromRules = exports.getRulesFromRules = exports.getExpoBabelLoader = exports.getRules = exports.getRulesAsItems = exports.findLoader = void 0;\n\nvar util_1 = require(\"util\");\n\nfunction findLoader(loaderName, rules) {\n  for (var _iterator = _createForOfIteratorHelperLoose(rules), _step; !(_step = _iterator()).done;) {\n    var rule = _step.value;\n\n    if (rule.use && rule.use.loader && (rule.use.loader.includes(\"/\" + loaderName) || rule.use.loader.includes(\"\\\\\" + loaderName))) {\n      return rule;\n    }\n  }\n\n  return null;\n}\n\nexports.findLoader = findLoader;\n\nfunction getRulesAsItems(rules) {\n  return rules.map(function (rule, index) {\n    return {\n      index: index,\n      rule: rule\n    };\n  });\n}\n\nexports.getRulesAsItems = getRulesAsItems;\n\nfunction getRules(config) {\n  var _ref = config.module || {},\n      _ref$rules = _ref.rules,\n      rules = _ref$rules === void 0 ? [] : _ref$rules;\n\n  return getRulesAsItems(getRulesFromRules(rules));\n}\n\nexports.getRules = getRules;\n\nfunction getExpoBabelLoader(config) {\n  var _a, _b;\n\n  var _ref2 = config.module || {},\n      _ref2$rules = _ref2.rules,\n      rules = _ref2$rules === void 0 ? [] : _ref2$rules;\n\n  var currentRules = getRulesAsItems(getRulesFromRules(rules));\n\n  for (var _iterator2 = _createForOfIteratorHelperLoose(currentRules), _step2; !(_step2 = _iterator2()).done;) {\n    var ruleItem = _step2.value;\n    var rule = ruleItem.rule;\n\n    if (rule.use && typeof rule.use === 'object' && ((_b = (_a = rule.use.options) === null || _a === void 0 ? void 0 : _a.caller) === null || _b === void 0 ? void 0 : _b.__dangerous_rule_id) === 'expo-babel-loader') {\n      return rule;\n    }\n  }\n\n  return null;\n}\n\nexports.getExpoBabelLoader = getExpoBabelLoader;\n\nfunction getRulesFromRules(rules) {\n  var output = [];\n\n  for (var _iterator3 = _createForOfIteratorHelperLoose(rules), _step3; !(_step3 = _iterator3()).done;) {\n    var rule = _step3.value;\n\n    if (rule.oneOf) {\n      output.push.apply(output, _toConsumableArray(getRulesFromRules(rule.oneOf)));\n    } else {\n      output.push(rule);\n    }\n  }\n\n  return output;\n}\n\nexports.getRulesFromRules = getRulesFromRules;\n\nfunction getLoadersFromRules(rules) {\n  var loaders = rules.map(function (_ref3) {\n    var rule = _ref3.rule,\n        ruleIndex = _ref3.index;\n\n    if (rule.oneOf) {\n      return getLoadersFromRules(getRulesAsItems(rule.oneOf));\n    }\n\n    return loaderToLoaderItemLoaderPart(rule.loaders || rule.loader || rule.use).map(function (loader) {\n      return _objectSpread(_objectSpread({}, loader), {}, {\n        rule: rule,\n        ruleIndex: ruleIndex\n      });\n    });\n  });\n  return loaders.reduce(function (arr, a) {\n    return arr.concat(a);\n  }, []);\n}\n\nexports.getLoadersFromRules = getLoadersFromRules;\n\nfunction getLoaders(config) {\n  var rules = getRules(config);\n  return getLoadersFromRules(rules);\n}\n\nexports.getLoaders = getLoaders;\n\nfunction loaderToLoaderItemLoaderPart(loader) {\n  if (!loader) return [];\n  var loaders = [];\n\n  if (typeof loader === 'function') {\n    loaders.push.apply(loaders, _toConsumableArray(loaderToLoaderItemLoaderPart(loader({}))));\n  } else if (isRuleSetItem(loader)) {\n    loaders.push({\n      loader: loader,\n      loaderIndex: -1\n    });\n  } else if (Array.isArray(loader)) {\n    loaders.push.apply(loaders, _toConsumableArray(loader.map(function (loader, loaderIndex) {\n      return {\n        loader: loader,\n        loaderIndex: loaderIndex\n      };\n    })));\n  }\n\n  return loaders;\n}\n\nfunction getRulesByMatchingFiles(config, files) {\n  var rules = getRules(config);\n  var selectedRules = {};\n\n  var _loop = function _loop(file) {\n    selectedRules[file] = rules.filter(function (_ref4) {\n      var rule = _ref4.rule;\n      return conditionMatchesFile(rule.test, file);\n    });\n  };\n\n  for (var _iterator4 = _createForOfIteratorHelperLoose(files), _step4; !(_step4 = _iterator4()).done;) {\n    var file = _step4.value;\n\n    _loop(file);\n  }\n\n  return selectedRules;\n}\n\nexports.getRulesByMatchingFiles = getRulesByMatchingFiles;\n\nfunction rulesMatchAnyFiles(config, files) {\n  var rules = getRulesByMatchingFiles(config, files);\n  return Object.keys(rules).some(function (filename) {\n    return !!rules[filename].length;\n  });\n}\n\nexports.rulesMatchAnyFiles = rulesMatchAnyFiles;\n\nfunction resolveRuleSetUse(rule) {\n  if (!rule) return [];\n\n  if (Array.isArray(rule)) {\n    var rules = rule;\n    var resolved = [];\n\n    for (var _iterator5 = _createForOfIteratorHelperLoose(rules), _step5; !(_step5 = _iterator5()).done;) {\n      var _rule = _step5.value;\n      resolved = [].concat(_toConsumableArray(resolved), _toConsumableArray(resolveRuleSetUse(_rule)));\n    }\n\n    return resolved;\n  } else if (typeof rule === 'string' || isRuleSetLoader(rule)) {\n    return [rule];\n  } else if (typeof rule === 'function') {\n    return resolveRuleSetUse(rule({}));\n  }\n\n  return [rule];\n}\n\nexports.resolveRuleSetUse = resolveRuleSetUse;\n\nfunction conditionMatchesFile(condition, file) {\n  if (!condition) return false;\n\n  if (util_1.isRegExp(condition)) {\n    return condition.test(file);\n  } else if (typeof condition === 'string') {\n    return file.startsWith(condition);\n  } else if (typeof condition === 'function') {\n    return Boolean(condition(file));\n  } else if (Array.isArray(condition)) {\n    return condition.some(function (c) {\n      return conditionMatchesFile(c, file);\n    });\n  }\n\n  return Object.entries(condition).map(function (_ref5) {\n    var _ref6 = _slicedToArray(_ref5, 2),\n        key = _ref6[0],\n        value = _ref6[1];\n\n    switch (key) {\n      case 'test':\n        return conditionMatchesFile(value, file);\n\n      case 'include':\n        return conditionMatchesFile(value, file);\n\n      case 'exclude':\n        return !conditionMatchesFile(value, file);\n\n      case 'and':\n        return value.every(function (c) {\n          return conditionMatchesFile(c, file);\n        });\n\n      case 'or':\n        return value.some(function (c) {\n          return conditionMatchesFile(c, file);\n        });\n\n      case 'not':\n        return value.every(function (c) {\n          return !conditionMatchesFile(c, file);\n        });\n\n      default:\n        return true;\n    }\n  }).every(function (b) {\n    return b;\n  });\n}\n\nexports.conditionMatchesFile = conditionMatchesFile;\n\nfunction getPlugins(_ref7) {\n  var _ref7$plugins = _ref7.plugins,\n      plugins = _ref7$plugins === void 0 ? [] : _ref7$plugins;\n  return plugins.map(function (plugin, index) {\n    return {\n      index: index,\n      plugin: plugin\n    };\n  });\n}\n\nexports.getPlugins = getPlugins;\n\nfunction getPluginsByName(config, name) {\n  return getPlugins(config).filter(function (_ref8) {\n    var plugin = _ref8.plugin;\n\n    if (plugin && plugin.constructor) {\n      return plugin.constructor.name === name;\n    }\n\n    return false;\n  });\n}\n\nexports.getPluginsByName = getPluginsByName;\n\nfunction isRuleSetItem(loader) {\n  return typeof loader === 'string' || typeof loader === 'function' || isRuleSetLoader(loader);\n}\n\nexports.isRuleSetItem = isRuleSetItem;\n\nfunction isRuleSetLoader(loader) {\n  return Object.keys(loader).some(function (k) {\n    return ['loader', 'options', 'indent', 'query'].includes(k);\n  });\n}\n\nexports.isRuleSetLoader = isRuleSetLoader;\n\nfunction isEntry(arg) {\n  if (typeof arg !== 'object' || arg === null) {\n    return false;\n  }\n\n  return Object.values(arg).every(function (value) {\n    if (Array.isArray(value)) {\n      return value.every(function (value) {\n        return typeof value === 'string';\n      });\n    }\n\n    return typeof value === 'string';\n  });\n}\n\nexports.isEntry = isEntry;\n\nfunction resolveEntryAsync(arg) {\n  return _regeneratorRuntime.async(function resolveEntryAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (!(typeof arg === 'undefined')) {\n            _context.next = 2;\n            break;\n          }\n\n          throw new Error('Webpack config entry cannot be undefined');\n\n        case 2:\n          if (!(typeof arg === 'function')) {\n            _context.next = 10;\n            break;\n          }\n\n          _context.t0 = resolveEntryAsync;\n          _context.next = 6;\n          return _regeneratorRuntime.awrap(arg());\n\n        case 6:\n          _context.t1 = _context.sent;\n          return _context.abrupt(\"return\", (0, _context.t0)(_context.t1));\n\n        case 10:\n          if (!(typeof arg === 'string')) {\n            _context.next = 14;\n            break;\n          }\n\n          return _context.abrupt(\"return\", resolveEntryAsync([arg]));\n\n        case 14:\n          if (!Array.isArray(arg)) {\n            _context.next = 18;\n            break;\n          }\n\n          return _context.abrupt(\"return\", {\n            app: arg\n          });\n\n        case 18:\n          if (!isEntry(arg)) {\n            _context.next = 20;\n            break;\n          }\n\n          return _context.abrupt(\"return\", arg);\n\n        case 20:\n          throw new Error('Cannot resolve Webpack config entry prop: ' + arg);\n\n        case 21:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nexports.resolveEntryAsync = resolveEntryAsync;","map":{"version":3,"sources":["../../src/utils/search.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Loader flattening inspired by:\n * https://github.com/preactjs/preact-cli-experiment/tree/7b80623/packages/cli-plugin-legacy-config\n */\nimport { isRegExp } from 'util';\nimport {\n  Configuration,\n  Entry,\n  Plugin,\n  Rule,\n  RuleSetCondition,\n  RuleSetLoader,\n  RuleSetRule,\n  RuleSetUse,\n  RuleSetUseItem,\n} from 'webpack';\n\nimport { DevConfiguration } from '../types';\n\ntype AnyConfiguration = Configuration | DevConfiguration;\n\ntype LoaderItemLoaderPart = Pick<LoaderItem, 'loader' | 'loaderIndex'>;\n\ninterface RuleItem {\n  rule: RuleSetRule;\n  index: number;\n}\n\ntype ResolvedRuleSet = string | RuleSetLoader;\n\ninterface PluginItem {\n  plugin: Plugin;\n  index: number;\n}\n\ninterface LoaderItem {\n  rule: RuleSetRule;\n  ruleIndex: number;\n  loader: RuleSetUseItem;\n  loaderIndex: number;\n}\n\n/**\n *\n * @param loaderName\n * @param rules\n * @category utils\n */\nexport function findLoader(loaderName: string, rules: RuleSetRule[]): RuleSetRule | null {\n  for (const rule of rules) {\n    if (\n      rule.use &&\n      (rule.use as any).loader &&\n      ((rule.use as RuleSetLoader).loader!.includes(`/${loaderName}`) ||\n        (rule.use as any).loader.includes(`\\\\${loaderName}`))\n    ) {\n      return rule;\n    }\n  }\n  return null;\n}\n\n/**\n *\n * @param rules\n * @category utils\n */\nexport function getRulesAsItems(rules: RuleSetRule[]): RuleItem[] {\n  return rules.map((rule, index) => ({\n    index,\n    rule,\n  }));\n}\n\n/**\n *\n * @param config\n * @category utils\n */\nexport function getRules(config: AnyConfiguration): RuleItem[] {\n  const { rules = [] } = config.module || {};\n  return getRulesAsItems(getRulesFromRules(rules));\n}\n\n/**\n * Get the babel-loader rule created by `@expo/webpack-config/loaders`\n *\n * @param config\n * @category utils\n */\nexport function getExpoBabelLoader(config: AnyConfiguration): Rule | null {\n  const { rules = [] } = config.module || {};\n  const currentRules = getRulesAsItems(getRulesFromRules(rules));\n  for (const ruleItem of currentRules) {\n    const rule: any = ruleItem.rule;\n    if (\n      rule.use &&\n      typeof rule.use === 'object' &&\n      rule.use.options?.caller?.__dangerous_rule_id === 'expo-babel-loader'\n    ) {\n      return rule;\n    }\n  }\n  return null;\n}\n\n/**\n *\n * @param rules\n * @category utils\n */\nexport function getRulesFromRules(rules: RuleSetRule[]): RuleSetRule[] {\n  const output: RuleSetRule[] = [];\n\n  for (const rule of rules) {\n    if (rule.oneOf) {\n      output.push(...getRulesFromRules(rule.oneOf));\n    } else {\n      output.push(rule);\n    }\n  }\n  return output;\n}\n\n/**\n *\n * @param rules\n * @category utils\n */\nexport function getLoadersFromRules(rules: RuleItem[]): LoaderItem[] {\n  const loaders = rules.map(({ rule, index: ruleIndex }) => {\n    if (rule.oneOf) {\n      return getLoadersFromRules(getRulesAsItems(rule.oneOf));\n    }\n    return loaderToLoaderItemLoaderPart(rule.loaders || rule.loader || rule.use).map(loader => ({\n      ...loader,\n      rule,\n      ruleIndex,\n    }));\n  });\n\n  return loaders.reduce((arr, a) => arr.concat(a), []);\n}\n\n/**\n *\n * @param config\n * @category utils\n */\nexport function getLoaders(config: AnyConfiguration): LoaderItem[] {\n  const rules = getRules(config);\n  return getLoadersFromRules(rules);\n}\n\nfunction loaderToLoaderItemLoaderPart(loader: RuleSetUse | undefined): LoaderItemLoaderPart[] {\n  if (!loader) return [];\n  const loaders: LoaderItemLoaderPart[] = [];\n  if (typeof loader === 'function') {\n    loaders.push(...loaderToLoaderItemLoaderPart(loader({})));\n  } else if (isRuleSetItem(loader)) {\n    loaders.push({ loader, loaderIndex: -1 });\n  } else if (Array.isArray(loader)) {\n    loaders.push(...loader.map((loader, loaderIndex) => ({ loader, loaderIndex })));\n  }\n  return loaders;\n}\n\n/**\n *\n * @param config\n * @param files\n * @category utils\n */\nexport function getRulesByMatchingFiles(\n  config: AnyConfiguration,\n  files: string[]\n): { [key: string]: RuleItem[] } {\n  const rules = getRules(config);\n  const selectedRules: { [key: string]: RuleItem[] } = {};\n  for (const file of files) {\n    selectedRules[file] = rules.filter(({ rule }) => conditionMatchesFile(rule.test, file));\n  }\n  return selectedRules;\n}\n\n/**\n *\n * @param config\n * @param files\n * @category utils\n */\nexport function rulesMatchAnyFiles(config: AnyConfiguration, files: string[]): boolean {\n  const rules = getRulesByMatchingFiles(config, files);\n  return Object.keys(rules).some(filename => !!rules[filename].length);\n}\n\n/**\n *\n * @param rule\n * @category utils\n */\nexport function resolveRuleSetUse(rule?: RuleSetUse | RuleSetUse[]): ResolvedRuleSet[] {\n  if (!rule) return [];\n  if (Array.isArray(rule)) {\n    const rules = rule as RuleSetUse[];\n    let resolved: ResolvedRuleSet[] = [];\n    for (const rule of rules) {\n      resolved = [...resolved, ...resolveRuleSetUse(rule)];\n    }\n    return resolved;\n  } else if (typeof rule === 'string' || isRuleSetLoader(rule)) {\n    return [rule];\n  } else if (typeof rule === 'function') {\n    return resolveRuleSetUse(rule({}));\n  }\n  return [rule];\n}\n\n/**\n *\n * @param condition\n * @param file\n * @category utils\n */\nexport function conditionMatchesFile(\n  condition: RuleSetCondition | undefined,\n  file: string\n): boolean {\n  if (!condition) return false;\n  if (isRegExp(condition)) {\n    return condition.test(file);\n  } else if (typeof condition === 'string') {\n    return file.startsWith(condition);\n  } else if (typeof condition === 'function') {\n    return Boolean(condition(file));\n  } else if (Array.isArray(condition)) {\n    return condition.some(c => conditionMatchesFile(c, file));\n  }\n  return Object.entries(condition)\n    .map(([key, value]) => {\n      switch (key) {\n        case 'test':\n          return conditionMatchesFile(value, file);\n        case 'include':\n          return conditionMatchesFile(value, file);\n        case 'exclude':\n          return !conditionMatchesFile(value, file);\n        case 'and':\n          return (value as RuleSetCondition[]).every(c => conditionMatchesFile(c, file));\n        case 'or':\n          return (value as RuleSetCondition[]).some(c => conditionMatchesFile(c, file));\n        case 'not':\n          return (value as RuleSetCondition[]).every(c => !conditionMatchesFile(c, file));\n        default:\n          return true;\n      }\n    })\n    .every(b => b);\n}\n\n/**\n *\n * @param param0\n * @category utils\n */\nexport function getPlugins({ plugins = [] }: AnyConfiguration): PluginItem[] {\n  return plugins.map((plugin, index) => ({ index, plugin }));\n}\n\n/**\n *\n * @param config\n * @param name\n * @category utils\n */\nexport function getPluginsByName(config: AnyConfiguration, name: string): PluginItem[] {\n  return getPlugins(config).filter(({ plugin }: PluginItem) => {\n    if (plugin && plugin.constructor) {\n      return plugin.constructor.name === name;\n    }\n    return false;\n  });\n}\n\n/**\n *\n * @param loader\n * @category utils\n */\nexport function isRuleSetItem(loader: RuleSetUse): loader is RuleSetUseItem {\n  return typeof loader === 'string' || typeof loader === 'function' || isRuleSetLoader(loader);\n}\n\n/**\n *\n * @param loader\n * @category utils\n */\nexport function isRuleSetLoader(loader: RuleSetUse): loader is RuleSetLoader {\n  return Object.keys(loader).some(k => ['loader', 'options', 'indent', 'query'].includes(k));\n}\n\n/**\n *\n * @param arg\n * @category utils\n */\nexport function isEntry(arg: any): arg is Entry {\n  if (typeof arg !== 'object' || arg === null) {\n    return false;\n  }\n  return Object.values(arg).every(value => {\n    if (Array.isArray(value)) {\n      return value.every(value => typeof value === 'string');\n    }\n    return typeof value === 'string';\n  });\n}\n\n/**\n *\n * @param arg\n * @category utils\n */\nexport async function resolveEntryAsync(arg: any): Promise<Entry> {\n  if (typeof arg === 'undefined') {\n    throw new Error('Webpack config entry cannot be undefined');\n  }\n\n  if (typeof arg === 'function') {\n    return resolveEntryAsync(await arg());\n  } else if (typeof arg === 'string') {\n    return resolveEntryAsync([arg]);\n  } else if (Array.isArray(arg)) {\n    return {\n      app: arg,\n    };\n  } else if (isEntry(arg)) {\n    return arg;\n  }\n\n  throw new Error('Cannot resolve Webpack config entry prop: ' + arg);\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}