{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchToTemp = exports.fetch = void 0;\n\nfunction os() {\n  var data = _interopRequireWildcard(require(\"os\"));\n\n  os = function os() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction path() {\n  var data = _interopRequireWildcard(require(\"path\"));\n\n  path = function path() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction fs() {\n  var data = _interopRequireWildcard(require(\"fs\"));\n\n  fs = function fs() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _nodeFetch() {\n  var data = _interopRequireDefault(require(\"node-fetch\"));\n\n  _nodeFetch = function _nodeFetch() {\n    return data;\n  };\n\n  return data;\n}\n\nvar _errors = require(\"./errors\");\n\nvar _logger = _interopRequireDefault(require(\"./logger\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction unwrapFetchResult(response) {\n  var data;\n  return _regeneratorRuntime.async(function unwrapFetchResult$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return _regeneratorRuntime.awrap(response.text());\n\n        case 2:\n          data = _context.sent;\n          _context.prev = 3;\n          return _context.abrupt(\"return\", JSON.parse(data));\n\n        case 7:\n          _context.prev = 7;\n          _context.t0 = _context[\"catch\"](3);\n          return _context.abrupt(\"return\", data);\n\n        case 10:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[3, 7]], Promise);\n}\n\nvar fetchToTemp = function fetchToTemp(url) {\n  try {\n    return new Promise(function (resolve, reject) {\n      var fileName = path().basename(url);\n      var tmpDir = path().join(os().tmpdir(), fileName);\n      (0, _nodeFetch().default)(url).then(function (result) {\n        if (result.status >= 400) {\n          return reject(\"Fetch request failed with status \" + result.status);\n        }\n\n        var dest = fs().createWriteStream(tmpDir);\n        result.body.pipe(dest);\n        result.body.on('end', function () {\n          resolve(tmpDir);\n        });\n        result.body.on('error', reject);\n      });\n    });\n  } catch (e) {\n    _logger.default.error(e);\n\n    throw e;\n  }\n};\n\nexports.fetchToTemp = fetchToTemp;\n\nvar fetch = function fetch(url, options) {\n  var result, data;\n  return _regeneratorRuntime.async(function fetch$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return _regeneratorRuntime.awrap((0, _nodeFetch().default)(url, options));\n\n        case 2:\n          result = _context2.sent;\n          _context2.next = 5;\n          return _regeneratorRuntime.awrap(unwrapFetchResult(result));\n\n        case 5:\n          data = _context2.sent;\n\n          if (!(result.status >= 400)) {\n            _context2.next = 8;\n            break;\n          }\n\n          throw new _errors.CLIError(\"Fetch request failed with status \" + result.status + \": \" + data + \".\");\n\n        case 8:\n          return _context2.abrupt(\"return\", {\n            status: result.status,\n            headers: result.headers,\n            data: data\n          });\n\n        case 9:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\n\nexports.fetch = fetch;","map":{"version":3,"sources":["C:/Users/Dereje/node_modules/@react-native-community/cli-tools/build/fetch.js"],"names":["Object","defineProperty","exports","value","fetchToTemp","fetch","os","data","_interopRequireWildcard","require","path","fs","_nodeFetch","_interopRequireDefault","_errors","_logger","obj","__esModule","default","_getRequireWildcardCache","WeakMap","cache","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","unwrapFetchResult","response","text","JSON","parse","url","Promise","resolve","reject","fileName","basename","tmpDir","join","tmpdir","then","result","status","dest","createWriteStream","body","pipe","on","e","error","options","CLIError","headers"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchToTemp = exports.fetch = void 0;\n\nfunction os() {\n  const data = _interopRequireWildcard(require(\"os\"));\n\n  os = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction path() {\n  const data = _interopRequireWildcard(require(\"path\"));\n\n  path = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction fs() {\n  const data = _interopRequireWildcard(require(\"fs\"));\n\n  fs = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _nodeFetch() {\n  const data = _interopRequireDefault(require(\"node-fetch\"));\n\n  _nodeFetch = function () {\n    return data;\n  };\n\n  return data;\n}\n\nvar _errors = require(\"./errors\");\n\nvar _logger = _interopRequireDefault(require(\"./logger\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nasync function unwrapFetchResult(response) {\n  const data = await response.text();\n\n  try {\n    return JSON.parse(data);\n  } catch (e) {\n    return data;\n  }\n}\n/**\n * Downloads the given `url` to the OS's temp folder and\n * returns the path to it.\n */\n\n\nconst fetchToTemp = url => {\n  try {\n    return new Promise((resolve, reject) => {\n      const fileName = path().basename(url);\n      const tmpDir = path().join(os().tmpdir(), fileName);\n      (0, _nodeFetch().default)(url).then(result => {\n        if (result.status >= 400) {\n          return reject(`Fetch request failed with status ${result.status}`);\n        }\n\n        const dest = fs().createWriteStream(tmpDir);\n        result.body.pipe(dest);\n        result.body.on('end', () => {\n          resolve(tmpDir);\n        });\n        result.body.on('error', reject);\n      });\n    });\n  } catch (e) {\n    _logger.default.error(e);\n\n    throw e;\n  }\n};\n\nexports.fetchToTemp = fetchToTemp;\n\nconst fetch = async (url, options) => {\n  const result = await (0, _nodeFetch().default)(url, options);\n  const data = await unwrapFetchResult(result);\n\n  if (result.status >= 400) {\n    throw new _errors.CLIError(`Fetch request failed with status ${result.status}: ${data}.`);\n  }\n\n  return {\n    status: result.status,\n    headers: result.headers,\n    data\n  };\n};\n\nexports.fetch = fetch;\n\n//# sourceMappingURL=fetch.js.map"]},"metadata":{},"sourceType":"script"}